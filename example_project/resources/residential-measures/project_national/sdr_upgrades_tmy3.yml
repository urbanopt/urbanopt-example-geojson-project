schema_version: '0.6'
os_version: 3.10.0
os_sha: 86d7e215a1
buildstock_directory: ../ # Relative to this file or absolute
project_directory: project_national # Relative to buildstock_directory
output_directory: sdr_upgrades_tmy3
weather_files_url: https://data.nrel.gov/system/files/156/Buildstock_TMY3_FIPS-1678817889.zip
# weather_files_path: c:/OpenStudio/BuildStock_TMY3_FIPS.zip # Local weather files example
# weather_files_path: /kfs2/shared-projects/buildstock/weather/BuildStock_TMY3_FIPS.zip # Kestrel TMY3 weather files
# weather_files_path: /kfs2/shared-projects/buildstock/weather/BuildStock_2018_FIPS.zip # Kestrel 2018 weather files

# Baseline number of units
baseline:
  n_buildings_represented: 139647020 # American Community Survey 2021 5-year, B25001, does not include territories

# Sampler type and number of data points per baseline or upgrade
sampler:
  type: precomputed
  # type: residential_quota # For production run
  args:
    sample_file: resources/sdr_minimal_buildstock.csv # For CI
    # n_datapoints: 550000 # For production run

# NREL High Performance Computing machine configuration
# Not used if running buildstock_local (local tests and CI)
kestrel:
  n_jobs: 600
  minutes_per_sim: 10
  account: <account>
  postprocessing:
    time: 800
    n_workers: 20
    n_procs: 20
  sampling:
    time: 60

# Post proccessing and Amazon Web Services
postprocessing:
  # Post simulation partitioning
  keep_individual_timeseries: true
  partition_columns:
    - State
    - County
  publish_annual_results: true
  # AWS upload bucket and athena setup (uncomment during production and testing runs)
  aws:
   region_name: us-west-2
   s3:
     bucket: resstock-core
     prefix: resstock_ci
   athena:
     glue_service_role: service-role/AWSGlueServiceRole-default
     database_name: resstock_core
     max_crawling_time: 1200

# Workflow generator
workflow_generator:
  # ResStock HPXML workflow generator
  type: residential_hpxml
  version: 2025.04.29

  args:
    # Annual simulation and timestep
    build_existing_model:
      simulation_control_timestep: 15
      simulation_control_run_period_begin_month: 1
      simulation_control_run_period_begin_day_of_month: 1
      simulation_control_run_period_end_month: 12
      simulation_control_run_period_end_day_of_month: 31
      simulation_control_run_period_calendar_year: 2018

    # Emissions scenarios
    emissions:
      - scenario_name: AER_HighRECost_Avg
        type: CO2e
        elec_folder: data/emissions/cambium/2024/AER_HighRECost_Avg
      - scenario_name: AER_HighRECostLowNGPrice_Avg
        type: CO2e
        elec_folder: data/emissions/cambium/2024/AER_HighRECostLowNGPrice_Avg
      - scenario_name: AER_LowRECost_Avg
        type: CO2e
        elec_folder: data/emissions/cambium/2024/AER_LowRECost_Avg
      - scenario_name: AER_LowRECostHighNGPrice_Avg
        type: CO2e
        elec_folder: data/emissions/cambium/2024/AER_LowRECostHighNGPrice_Avg
      - scenario_name: AER_MidCase_Avg
        type: CO2e
        elec_folder: data/emissions/cambium/2024/AER_MidCase_Avg
      - scenario_name: LRMER_HighRECost_15
        type: CO2e
        elec_folder: data/emissions/cambium/2024/LRMER_HighRECost_15
      - scenario_name: LRMER_HighRECost_25
        type: CO2e
        elec_folder: data/emissions/cambium/2024/LRMER_HighRECost_25
      - scenario_name: LRMER_HighRECostLowNGPrice_15
        type: CO2e
        elec_folder: data/emissions/cambium/2024/LRMER_HighRECostLowNGPrice_15
      - scenario_name: LRMER_HighRECostLowNGPrice_25
        type: CO2e
        elec_folder: data/emissions/cambium/2024/LRMER_HighRECostLowNGPrice_25
      - scenario_name: LRMER_LowRECost_15
        type: CO2e
        elec_folder: data/emissions/cambium/2024/LRMER_LowRECost_15
      - scenario_name: LRMER_LowRECost_25
        type: CO2e
        elec_folder: data/emissions/cambium/2024/LRMER_LowRECost_25
      - scenario_name: LRMER_LowRECostHighNGPrice_15
        type: CO2e
        elec_folder: data/emissions/cambium/2024/LRMER_LowRECostHighNGPrice_15
      - scenario_name: LRMER_LowRECostHighNGPrice_25
        type: CO2e
        elec_folder: data/emissions/cambium/2024/LRMER_LowRECostHighNGPrice_25
      - scenario_name: LRMER_MidCase_15
        type: CO2e
        elec_folder: data/emissions/cambium/2024/LRMER_MidCase_15
      - scenario_name: LRMER_MidCase_25
        type: CO2e
        elec_folder: data/emissions/cambium/2024/LRMER_MidCase_25

    # Utility bill rates
    utility_bills:
      - scenario_name: Utility Rates - Fixed + Variable
        simple_filepath: data/utility_bills/sdr_rates/State.tsv

    # Outputs to include
    simulation_output_report:
      timeseries_frequency: timestep
      include_timeseries_total_consumptions: true
      include_timeseries_fuel_consumptions: true
      include_timeseries_end_use_consumptions: true
      include_timeseries_emissions: true
      include_timeseries_emission_fuels: true
      include_timeseries_emission_end_uses: false
      include_timeseries_hot_water_uses: true
      include_timeseries_total_loads: true
      include_timeseries_component_loads: true
      include_timeseries_unmet_hours: true
      include_timeseries_zone_temperatures: true
      include_timeseries_zone_conditions: true
      include_timeseries_airflows: true
      include_timeseries_weather: true
      include_timeseries_resilience: true
      output_variables:
        - name: People Sensible Heating Rate
        - name: People Total Heating Rate
        - name: Site Outdoor Air Humidity Ratio

    # Other reporting measures to run
    reporting_measures:
      - measure_dir_name: QOIReport
      - measure_dir_name: ServerDirectoryCleanup # tack this on so we can save some disk space (when using debug: true)

    # Files to keep
    server_directory_cleanup:
      retain_in_idf: true
      retain_schedules_csv: true
      retain_in_osm: true

    debug: true

references:
  ### -- Anchors not dependent on other anchors -- ###
  attic_insulation_iecc_cz1a: &attic_insulation_iecc_cz1a
    option: Insulation Ceiling|R-30
    apply_logic:
      - ASHRAE IECC Climate Zone 2004|1A
      - Geometry Attic Type|Vented Attic
      - or:
        - Insulation Ceiling|Uninsulated
        - Insulation Ceiling|R-7
        - Insulation Ceiling|R-13
        - Insulation Ceiling|R-19
    costs:
      - value: 0.0482
        multiplier: Floor Area, Attic * Insulation Increase (ft^2 * Delta R-value)
      - value: 0.2163
        multiplier: Floor Area, Attic (ft^2)
    lifetime: 60

  attic_insulation_iecc_cz2a_2b_3a_3b_3c: &attic_insulation_iecc_cz2a_2b_3a_3b_3c
    option: Insulation Ceiling|R-49
    apply_logic:
      - or:
        - ASHRAE IECC Climate Zone 2004|2A
        - ASHRAE IECC Climate Zone 2004|2B
        - ASHRAE IECC Climate Zone 2004|3A
        - ASHRAE IECC Climate Zone 2004|3B
        - ASHRAE IECC Climate Zone 2004|3C
      - Geometry Attic Type|Vented Attic
      - or:
        - Insulation Ceiling|Uninsulated
        - Insulation Ceiling|R-7
        - Insulation Ceiling|R-13
        - Insulation Ceiling|R-19
        - Insulation Ceiling|R-30
        - Insulation Ceiling|R-38
    costs:
      - value: 0.0482
        multiplier: Floor Area, Attic * Insulation Increase (ft^2 * Delta R-value)
      - value: 0.2163
        multiplier: Floor Area, Attic (ft^2)
    lifetime: 60

  attic_insulation_iecc_cz4b_4b_4b_5b_5b_6b_6b_7a_7b: &attic_insulation_iecc_cz4b_4b_4b_5b_5b_6b_6b_7a_7b
    option: Insulation Ceiling|R-60
    apply_logic:
      - or:
        - ASHRAE IECC Climate Zone 2004|4A
        - ASHRAE IECC Climate Zone 2004|4B
        - ASHRAE IECC Climate Zone 2004|4C
        - ASHRAE IECC Climate Zone 2004|5A
        - ASHRAE IECC Climate Zone 2004|5B
        - ASHRAE IECC Climate Zone 2004|6A
        - ASHRAE IECC Climate Zone 2004|6B
        - ASHRAE IECC Climate Zone 2004|7A
        - ASHRAE IECC Climate Zone 2004|7B
      - Geometry Attic Type|Vented Attic
      - or:
        - Insulation Ceiling|Uninsulated
        - Insulation Ceiling|R-7
        - Insulation Ceiling|R-13
        - Insulation Ceiling|R-19
        - Insulation Ceiling|R-30
        - Insulation Ceiling|R-38
        - Insulation Ceiling|R-49
    costs:
      - value: 0.0482
        multiplier: Floor Area, Attic * Insulation Increase (ft^2 * Delta R-value)
      - value: 0.2163
        multiplier: Floor Area, Attic (ft^2)
    lifetime: 60

  costs_ashp_ducted_seer_20_11_hspf: &costs_ashp_ducted_seer_20_11_hspf
    - value: 10229.58
      multiplier: Fixed (1)
    - value: 167.64
      multiplier: Size, Heating System Primary (kBtu/h)

  costs_ghp: &costs_ghp
    - value: 999
      multiplier: Fixed (1)
    - value: 999
      multiplier: Size, Heating System Primary (kBtu/h)

  demand_flexibility_30_minute_random_shift: &demand_flexibility_30_minute_random_shift
    option: Demand Flexibility Random Shift|30 minutes

  demand_flexibility_electric_vehicle: &demand_flexibility_electric_vehicle
    option: Demand Flexibility Electric Vehicle|Enabled

  ducted_ashp_apply_logic: &ducted_ashp_apply_logic
    - HVAC Has Ducts|Yes
    - not:
      - or:
        - HVAC Shared Efficiencies|Boiler Baseboards Heating Only, Electricity
        - HVAC Shared Efficiencies|Boiler Baseboards Heating Only, Fuel
        - HVAC Shared Efficiencies|Fan Coil Heating and Cooling, Electricity
        - HVAC Shared Efficiencies|Fan Coil Heating and Cooling, Fuel
        - HVAC Shared Efficiencies|Fan Coil Cooling Only

  ev_15_percent_efficiency: &ev_15_percent_efficiency
    option: Electric Vehicle Efficiency Increase|15%

  ev_l2_charger: &ev_l2_charger
    option: Electric Vehicle Charger|Level 2 charger

  ev_ownership_yes: &ev_ownership_yes
    option: Electric Vehicle Ownership|Yes

  has_cooling_or_heating: &has_cooling_or_heating
    - or:
      - not: HVAC Cooling Type|None
      - not: HVAC Heating Type|None

  infiltration_30_percent_reduction: &infiltration_30_percent_reduction
    option: Infiltration Reduction|30%
    apply_logic:
      - or:
        - Infiltration|50 ACH50
        - Infiltration|40 ACH50
        - Infiltration|30 ACH50
        - Infiltration|25 ACH50
        - Infiltration|20 ACH50
        - Infiltration|15 ACH50
    costs:
      - value: 0.53
        multiplier: Floor Area, Conditioned (ft^2)
    lifetime: 60

  lifetime_ducted_ashp: &lifetime_ducted_ashp 15

  lifetime_ducted_ghp: &lifetime_ducted_ghp 15

  occupied_only: &occupied_only
    Vacancy Status|Occupied

  partial_conditioning_100_percent_ducts_only: &partial_conditioning_100_percent_ducts_only
    option: HVAC Cooling Partial Space Conditioning|100% Conditioned
    apply_logic:
      - HVAC Has Ducts|Yes

  remove_high_rise_shared: &remove_high_rise_shared
    - not: Heating Fuel|Wood
    - not: Heating Fuel|Other Fuel
    - not: Heating Fuel|None
    - not:
      - or:
        - HVAC Shared Efficiencies|Boiler Baseboards Heating Only, Electricity
        - HVAC Shared Efficiencies|Boiler Baseboards Heating Only, Fuel
        - HVAC Shared Efficiencies|Fan Coil Heating and Cooling, Electricity
        - HVAC Shared Efficiencies|Fan Coil Heating and Cooling, Fuel
        - HVAC Shared Efficiencies|Fan Coil Cooling Only
      - and:
        - Geometry Building Type Height|Multi-Family with 5+ Units, 8+ Stories

  remove_nonducted_high_rise_shared: &remove_nonducted_high_rise_shared
    - HVAC Has Ducts|Yes
    - not: Heating Fuel|Wood
    - not: Heating Fuel|Other Fuel
    - not: Heating Fuel|None
    - not:
      - or:
        - HVAC Shared Efficiencies|Boiler Baseboards Heating Only, Electricity
        - HVAC Shared Efficiencies|Boiler Baseboards Heating Only, Fuel
        - HVAC Shared Efficiencies|Fan Coil Heating and Cooling, Electricity
        - HVAC Shared Efficiencies|Fan Coil Heating and Cooling, Fuel
        - HVAC Shared Efficiencies|Fan Coil Cooling Only
      - and:
        - Geometry Building Type Height|Multi-Family with 5+ Units, 8+ Stories

  # FIXME: We'd prefer to apply GHP to 0.5 and 0.8, but we are actively working on fixing a bug here.
  # When fixed, remove the following block and replace with use of remove_nonducted_high_rise_shared.
  remove_nonducted_high_rise_shared_low_ground_conductivity: &remove_nonducted_high_rise_shared_low_ground_conductivity
    - HVAC Has Ducts|Yes
    - not: Heating Fuel|Wood
    - not: Heating Fuel|Other Fuel
    - not: Heating Fuel|None
    - not:
      - or:
        - HVAC Shared Efficiencies|Boiler Baseboards Heating Only, Electricity
        - HVAC Shared Efficiencies|Boiler Baseboards Heating Only, Fuel
        - HVAC Shared Efficiencies|Fan Coil Heating and Cooling, Electricity
        - HVAC Shared Efficiencies|Fan Coil Heating and Cooling, Fuel
        - HVAC Shared Efficiencies|Fan Coil Cooling Only
      - and:
        - Geometry Building Type Height|Multi-Family with 5+ Units, 8+ Stories
    - not:
      - or:
        - Ground Thermal Conductivity|0.5
        - Ground Thermal Conductivity|0.8

  yes_and_no_has_ducts_apply_logic: &yes_and_no_has_ducts_apply_logic
    - or:
      - HVAC Has Ducts|Yes
      - HVAC Has Ducts|No

  ### -- Anchors dependent on other anchors -- ###
  cooling_setpoint_no_offset: &cooling_setpoint_no_offset
      option: Cooling Setpoint Has Offset|No
      apply_logic: *yes_and_no_has_ducts_apply_logic

  cooling_setpoint_offset_magnitude_0: &cooling_setpoint_offset_magnitude_0
      option: Cooling Setpoint Offset Magnitude|0F
      apply_logic: *yes_and_no_has_ducts_apply_logic

  cooling_setpoint_offset_period_none: &cooling_setpoint_offset_period_none
      option: Cooling Setpoint Offset Period|None
      apply_logic: *yes_and_no_has_ducts_apply_logic

  ducted_ashp_seer_20_11_hspf_cchp_electric_backup: &ducted_ashp_seer_20_11_hspf_cchp_electric_backup
      option: HVAC Heating Efficiency|ASHP, SEER 20, 11 HSPF, CCHP, Max Load
      apply_logic: *ducted_ashp_apply_logic
      costs: *costs_ashp_ducted_seer_20_11_hspf
      lifetime: *lifetime_ducted_ashp

  dual_speed_ducted_ghp: &dual_speed_ducted_ghp
      option: HVAC Heating Efficiency|GSHP, EER 20.5, COP 4.0
      apply_logic: *ducted_ashp_apply_logic
      costs: *costs_ghp
      lifetime: *lifetime_ducted_ghp

  heat_pump_cooling_efficiency_ducted: &heat_pump_cooling_efficiency_ducted
      option: HVAC Cooling Efficiency|Ducted Heat Pump
      apply_logic: *ducted_ashp_apply_logic

  heating_setpoint_no_offset: &heating_setpoint_no_offset
      option: Heating Setpoint Has Offset|No
      apply_logic: *yes_and_no_has_ducts_apply_logic

  heating_setpoint_offset_magnitude_0: &heating_setpoint_offset_magnitude_0
      option: Heating Setpoint Offset Magnitude|0F
      apply_logic: *yes_and_no_has_ducts_apply_logic

  heating_setpoint_offset_period_none: &heating_setpoint_offset_period_none
      option: Heating Setpoint Offset Period|None
      apply_logic: *yes_and_no_has_ducts_apply_logic

  partial_conditioning_100_percent: &partial_conditioning_100_percent
      option: HVAC Cooling Partial Space Conditioning|100% Conditioned
      apply_logic: *yes_and_no_has_ducts_apply_logic

### Standard Data Release - Residential -- ###
upgrades:
  ### -- HVAC: Air Source Heat Pumps -- ###
  - upgrade_name: Typical Cold Climate Ducted Air Source Heat Pump with Detailed Performance Data
    package_apply_logic: *remove_high_rise_shared
    options:
      - option: HVAC Heating Efficiency|ASHP, SEER2 17.5, 8.5 HSPF2, Typical Cold Climate
        apply_logic: *ducted_ashp_apply_logic

      - option: HVAC Detailed Performance Data|Cold Climate Heat Pump Ducted
        apply_logic: *ducted_ashp_apply_logic

      - *heat_pump_cooling_efficiency_ducted

  ### -- HVAC: Geothermal Heat Pumps -- ###
  - upgrade_name: Single-Speed Geothermal Heat Pump with Thermally Enhanced Grout and Pipes
    package_apply_logic: *remove_nonducted_high_rise_shared_low_ground_conductivity
    options:
      - option: HVAC Heating Efficiency|GSHP, EER 18.6, COP 3.8
        apply_logic: *ducted_ashp_apply_logic
        costs: *costs_ghp
        lifetime: *lifetime_ducted_ghp

      - *heat_pump_cooling_efficiency_ducted
      - *partial_conditioning_100_percent_ducts_only

  - upgrade_name: Dual-Speed Geothermal Heat Pump with Thermally Enhanced Grout and Pipes
    package_apply_logic: *remove_nonducted_high_rise_shared_low_ground_conductivity
    options:
      - *dual_speed_ducted_ghp
      - *heat_pump_cooling_efficiency_ducted
      - *partial_conditioning_100_percent_ducts_only

  - upgrade_name: Variable-Speed Geothermal Heat Pump with Thermally Enhanced Grout and Pipes
    package_apply_logic: *remove_nonducted_high_rise_shared_low_ground_conductivity
    options:
      - option: HVAC Heating Efficiency|GSHP, EER 30.9, COP 4.4
        apply_logic: *ducted_ashp_apply_logic
        costs: *costs_ghp
        lifetime: *lifetime_ducted_ghp

      - *heat_pump_cooling_efficiency_ducted
      - *partial_conditioning_100_percent_ducts_only

  ### -- Envelope and Ducts -- ###
  - upgrade_name: Air Sealing
    options:
      - *infiltration_30_percent_reduction

  - upgrade_name: Attic Floor Insulation for Unfinished Attics
    options:
    - *attic_insulation_iecc_cz1a
    - *attic_insulation_iecc_cz2a_2b_3a_3b_3c
    - *attic_insulation_iecc_cz4b_4b_4b_5b_5b_6b_6b_7a_7b

  ### -- Packages -- ###
  - upgrade_name: Package - Dual-Speed Geothermal Heat Pump with Thermally Enhanced Grout and Pipes with Air Sealing with Attic Floor Insulation
    package_apply_logic: *remove_nonducted_high_rise_shared_low_ground_conductivity
    options:
      ### -- Dual-Speed Ducted GHP -- ###
      - *dual_speed_ducted_ghp
      - *heat_pump_cooling_efficiency_ducted
      - *partial_conditioning_100_percent_ducts_only

      ### -- Attic Floor Insulation -- ###
      - *attic_insulation_iecc_cz1a
      - *attic_insulation_iecc_cz2a_2b_3a_3b_3c
      - *attic_insulation_iecc_cz4b_4b_4b_5b_5b_6b_6b_7a_7b

      ### -- Air Sealing -- ###
      - *infiltration_30_percent_reduction

  ### -- Electric Vehicles -- ###
  - upgrade_name: Electric Vehicle Adoption with Level 1 Charging
    package_apply_logic:
      - Electric Vehicle Ownership|No
      - *occupied_only
    options:
      - *ev_ownership_yes
      - option: Electric Vehicle Charger|Level 1 charger

  - upgrade_name: Electric Vehicle Adoption with Level 2 Charging
    package_apply_logic: *occupied_only
    options:
      - *ev_ownership_yes
      - *ev_l2_charger

  - upgrade_name: Efficient Electric Vehicle Adoption with Level 2 Charging
    package_apply_logic: *occupied_only
    options:
      - *ev_ownership_yes
      - *ev_l2_charger
      - *ev_15_percent_efficiency

  ### -- Electric Vehicles Demand Flexibility -- ###
  - upgrade_name: Electric Vehicle Adoption with Level 2 Charging and Demand Flexibility
    package_apply_logic: *occupied_only
    options:
      - *ev_ownership_yes
      - *ev_l2_charger
      - *demand_flexibility_electric_vehicle
      - *demand_flexibility_30_minute_random_shift

  - upgrade_name: Efficient Electric Vehicle Adoption with Level 2 Charging and Demand Flexibility
    package_apply_logic: *occupied_only
    options:
      - *ev_ownership_yes
      - *ev_l2_charger
      - *ev_15_percent_efficiency
      - *demand_flexibility_electric_vehicle
      - *demand_flexibility_30_minute_random_shift

  ### -- Thermostat Demand Flexibility -- ###
  - upgrade_name: HVAC Demand Flexibility - On-peak Load Shedding, 2F Offset
    package_apply_logic: *has_cooling_or_heating
    options:
      - option: Demand Flexibility HVAC|On-peak Load Shedding, 2F Offset
      - *demand_flexibility_30_minute_random_shift

  - upgrade_name: HVAC Demand Flexibility - Pre-peak Load Shifting, 2F Offset, 4hr Pre-peak Duration
    package_apply_logic: *has_cooling_or_heating
    options:
      - option: Demand Flexibility HVAC|Pre-peak Load Shifting, 2F Offset, 4hr Pre-peak Duration
      - *demand_flexibility_30_minute_random_shift

  - upgrade_name: HVAC Demand Flexibility - On-peak Load Shedding, 4F Offset
    package_apply_logic: *has_cooling_or_heating
    options:
      - option: Demand Flexibility HVAC|On-peak Load Shedding, 4F Offset
      - *demand_flexibility_30_minute_random_shift

  - upgrade_name: HVAC Demand Flexibility - Pre-peak Load Shifting, 4F Offset, 4hr Pre-peak Duration
    package_apply_logic: *has_cooling_or_heating
    options:
      - option: Demand Flexibility HVAC|Pre-peak Load Shifting, 4F Offset, 4hr Pre-peak Duration
      - *demand_flexibility_30_minute_random_shift

  - upgrade_name: HVAC Demand Flexibility - Pre-peak Load Shifting, 2F Offset, 1hr Pre-peak Duration
    package_apply_logic: *has_cooling_or_heating
    options:
      - option: Demand Flexibility HVAC|Pre-peak Load Shifting, 2F Offset, 1hr Pre-peak Duration
      - *demand_flexibility_30_minute_random_shift
